import{j as B,k as q,l as O,q as J,s as lt,b as yt,g as pt,r as gt,t as Z,o as ft,d as U,u as S,v as z,m as _t,e as bt,n as Tt,p as dt,S as mt,c as xt}from"./_initCloneObject.a41cf6bc.js";import{S as W,l as tt,f as ht,k as Mt,aU as Ct,d as Et,r as R,am as H,H as $,o as vt,a as m,c as x,e as s,a0 as Kt,L as I,F as N,a4 as _,a2 as w,b as Lt,t as F}from"./index.d2061719.js";function kt(e,r){for(var c=-1,b=e==null?0:e.length;++c<b&&r(e[c],c,e)!==!1;);return e}function wt(e,r){return e&&B(r,q(r),e)}function At(e,r){return e&&B(r,O(r),e)}function It(e,r){return B(e,J(e),r)}var Dt=Object.getOwnPropertySymbols,Ft=Dt?function(e){for(var r=[];e;)yt(r,J(e)),e=pt(e);return r}:lt;const et=Ft;function jt(e,r){return B(e,et(e),r)}function St(e){return gt(e,O,et)}var Bt=Object.prototype,Pt=Bt.hasOwnProperty;function Rt(e){var r=e.length,c=new e.constructor(r);return r&&typeof e[0]=="string"&&Pt.call(e,"index")&&(c.index=e.index,c.input=e.input),c}function $t(e,r){var c=r?Z(e.buffer):e.buffer;return new e.constructor(c,e.byteOffset,e.byteLength)}var Nt=/\w*$/;function Ot(e){var r=new e.constructor(e.source,Nt.exec(e));return r.lastIndex=e.lastIndex,r}var Y=W?W.prototype:void 0,Q=Y?Y.valueOf:void 0;function Ut(e){return Q?Object(Q.call(e)):{}}var Gt="[object Boolean]",Wt="[object Date]",Ht="[object Map]",Yt="[object Number]",Qt="[object RegExp]",Vt="[object Set]",Xt="[object String]",qt="[object Symbol]",Jt="[object ArrayBuffer]",Zt="[object DataView]",zt="[object Float32Array]",te="[object Float64Array]",ee="[object Int8Array]",ae="[object Int16Array]",se="[object Int32Array]",re="[object Uint8Array]",ce="[object Uint8ClampedArray]",ne="[object Uint16Array]",oe="[object Uint32Array]";function ie(e,r,c){var b=e.constructor;switch(r){case Jt:return Z(e);case Gt:case Wt:return new b(+e);case Zt:return $t(e,c);case zt:case te:case ee:case ae:case se:case re:case ce:case ne:case oe:return ft(e,c);case Ht:return new b;case Yt:case Xt:return new b(e);case Qt:return Ot(e);case Vt:return new b;case qt:return Ut(e)}}var ue="[object Map]";function le(e){return tt(e)&&U(e)==ue}var V=S&&S.isMap,ye=V?z(V):le;const pe=ye;var ge="[object Set]";function fe(e){return tt(e)&&U(e)==ge}var X=S&&S.isSet,_e=X?z(X):fe;const be=_e;var Te=1,de=2,me=4,at="[object Arguments]",xe="[object Array]",he="[object Boolean]",Me="[object Date]",Ce="[object Error]",st="[object Function]",Ee="[object GeneratorFunction]",ve="[object Map]",Ke="[object Number]",rt="[object Object]",Le="[object RegExp]",ke="[object Set]",we="[object String]",Ae="[object Symbol]",Ie="[object WeakMap]",De="[object ArrayBuffer]",Fe="[object DataView]",je="[object Float32Array]",Se="[object Float64Array]",Be="[object Int8Array]",Pe="[object Int16Array]",Re="[object Int32Array]",$e="[object Uint8Array]",Ne="[object Uint8ClampedArray]",Oe="[object Uint16Array]",Ue="[object Uint32Array]",u={};u[at]=u[xe]=u[De]=u[Fe]=u[he]=u[Me]=u[je]=u[Se]=u[Be]=u[Pe]=u[Re]=u[ve]=u[Ke]=u[rt]=u[Le]=u[ke]=u[we]=u[Ae]=u[$e]=u[Ne]=u[Oe]=u[Ue]=!0;u[Ce]=u[st]=u[Ie]=!1;function j(e,r,c,b,h,f){var y,L=r&Te,M=r&de,g=r&me;if(c&&(y=h?c(e,b,h,f):c(e)),y!==void 0)return y;if(!ht(e))return e;var D=Mt(e);if(D){if(y=Rt(e),!L)return _t(e,y)}else{var C=U(e),E=C==st||C==Ee;if(bt(e))return Tt(e,L);if(C==rt||C==at||E&&!h){if(y=M||E?{}:dt(e),!L)return M?jt(e,At(y,e)):It(e,wt(y,e))}else{if(!u[C])return h?e:{};y=ie(e,C,L)}}f||(f=new mt);var A=f.get(e);if(A)return A;f.set(e,y),be(e)?e.forEach(function(T){y.add(j(T,r,c,T,e,f))}):pe(e)&&e.forEach(function(T,d){y.set(d,j(T,r,c,d,e,f))});var P=g?M?St:xt:M?O:q,v=D?void 0:P(e);return kt(v||e,function(T,d){v&&(d=T,T=e[d]),Ct(y,d,j(T,r,c,d,e,f))}),y}var Ge=1,We=4;function He(e){return j(e,Ge|We)}const Ye={class:"qt-scrcpy-keymap-container"},Qe={class:"key-types"},Ve=s("div",{class:"key-type-item"},[s("div",{class:"name"},"\u6620\u5C04\u5F00\u5173:"),s("kbd",null,"~"),s("div",{class:"tips"},[_(" \u70B9\u51FB\u4FEE\u6539 "),s("br"),_(" \u70B9\u51FB\u5207\u6362\u6620\u5C04\u5F00\u5173 ")])],-1),Xe={class:"key-type-item"},qe=["draggable"],Je={class:"tips"},Ze=s("br",null,null,-1),ze={class:"key-type-item"},ta=s("div",{class:"tips"},[_(" \u62D6\u62FD\u6DFB\u52A0 "),s("br"),_(" \u5C06\u952E\u76D8\u7684\u6309\u952E\u6620\u5C04\u4E3A\u666E\u901A\u7684\u624B\u6307\u70B9\u51FB ")],-1),ea={class:"key-type-item"},aa={class:"name"},sa=s("div",{class:"tips"},[_(" \u70B9\u51FB\u9009\u62E9 "),s("br"),_(" \u9009\u62E9\u540E\u53EF\u4EE5\u6839\u636E\u622A\u56FE\u6765\u5E03\u5C40\u6620\u5C04\u6309\u952E ")],-1),ra=s("div",{class:"tips"},[_(" \u70B9\u51FB\u9009\u62E9 "),s("br"),_(" \u5C06\u914D\u7F6E\u4FDD\u5B58\u4E3A keymap.json ")],-1),ca=["src"],na=["width","height","viewBox"],oa=["data-index","data-type","cx","cy"],ia={key:1},ua=["cx","cy"],la=["data-index","data-type","cx","cy"],ya={key:2},pa=["cx","cy"],ga=["cx","cy"],fa=["data-index","data-type","cx","cy"],_a={key:3},ba=["x1","y1","x2","y2"],Ta=["data-index","data-type","cx","cy"],da=["data-index","data-type","cx","cy"],ma={key:4},xa=["data-index","data-type","cx","cy"],Ca=Et({__name:"QtScrcpyKeymap",setup(e){const r=R(""),c=H({x:0,y:0,width:1920,height:1080}),b=$(()=>`0 0 ${c.width} ${c.height}`),h=R(),f=R();function y(a){let n=a.target.files[0];if(!!n){var t=new FileReader;t.readAsDataURL(n),t.onload=function(o){var i;let p=(i=o.target)==null?void 0:i.result;r.value=p},t.onerror=function(o){console.error("Error reading file",o)}}}function L(){if(h.value){let{x:a,y:n,width:t,height:o}=h.value.getBoundingClientRect();c.x=a,c.y=n,c.width=t,c.height=o}}const M=$(()=>!1),g=H({switchKey:"Key_QuoteLeft",mouseMoveMap:{},keyMapNodes:[]}),D=$(()=>g.keyMapNodes.map(a=>{switch(a.type){case"KMT_CLICK":case"KMT_CLICK_TWICE":case"KMT_CLICK_MULTI":return{data:a,x:a.pos.x,y:a.pos.y};case"KMT_DRAG":return{data:a,x1:a.startPos.x,y1:a.startPos.y,x2:a.endPos.x,y2:a.endPos.y};case"KMT_STEER_WHEEL":return{data:a,x:a.centerPos.x,y:a.centerPos.y}}}));function C(a){a.dataTransfer&&(a.dataTransfer.setData("text/plain","mousemove"),a.dataTransfer.effectAllowed="copy")}function E(a,n){a.dataTransfer&&(a.dataTransfer.setData("text/plain",n),a.dataTransfer.effectAllowed="copy")}function A(a,n){const{scrollTop:t,scrollLeft:o}=f.value;let p=a-c.x+o,i=n-c.y+t;return{x:p,y:i}}function P(a){var K;const{pageX:n,pageY:t}=a;let{x:o,y:p}=A(n,t);const i=(K=a.dataTransfer)==null?void 0:K.getData("text/plain");switch(console.log(i),i){case"KMT_CLICK":let l={comment:"",type:"KMT_CLICK",key:"",pos:{x:o,y:p},switchMap:!1};g.keyMapNodes.push(l);break;case"KMT_CLICK_TWICE":let nt={comment:"",type:"KMT_CLICK_TWICE",key:"",pos:{x:o,y:p}};g.keyMapNodes.push(nt);break;case"KMT_CLICK_MULTI":let ot={comment:"",type:"KMT_CLICK_MULTI",key:"",pos:{x:o,y:p},delay:10};g.keyMapNodes.push(ot);break;case"KMT_DRAG":let it={comment:"",type:"KMT_DRAG",key:"",startPos:{x:o,y:p},endPos:{x:o+20,y:p+20}};g.keyMapNodes.push(it);break;case"KMT_STEER_WHEEL":let ut={comment:"",type:"KMT_STEER_WHEEL",centerPos:{x:o,y:p},leftOffset:.2,rightOffset:.2,upOffset:.2,downOffset:.2,leftKey:"",rightKey:"",upKey:"",downKey:""};g.keyMapNodes.push(ut);break;case"mousemove":g.mouseMoveMap={startPos:{x:o,y:p},speedRatio:10,speedRatioX:3.25,speedRatioY:1.25};break}a.preventDefault()}const v={type:null,index:null};function T(a){let{keyNode:n,type:t,index:o}=a.target.dataset;n==="keyNode"&&(v.index=o,v.type=t,document.addEventListener("mousemove",d,!0),document.addEventListener("mouseup",G,!0))}function d(a){let{type:n,index:t}=v;if(n&&t&&!isNaN(t)){let{pageX:o,pageY:p}=a,{x:i,y:K}=A(o,p),l=g.keyMapNodes[t];switch(n){case"KMT_CLICK":case"KMT_CLICK_TWICE":case"KMT_CLICK_MULTI":l=l,l.pos.x=i,l.pos.y=K;break;case"KMT_DRAG_start":l=l,l.startPos.x=i,l.startPos.y=K;break;case"KMT_DRAG_end":l=l,l.endPos.x=i,l.endPos.y=K;break;case"KMT_STEER_WHEEL":l=l,l.centerPos.x=i,l.centerPos.y=K;break}g.keyMapNodes[t]=l}}function G(a){v.type=null,v.index=null,document.removeEventListener("mousemove",d,!0),document.removeEventListener("mouseup",G,!0)}function k({x:a,y:n}){return a=parseFloat((a/c.width).toFixed(2)),n=parseFloat((n/c.height).toFixed(2)),{x:a,y:n}}function ct(){var o,p;let a=He(g);(o=a.mouseMoveMap)!=null&&o.startPos&&(a.mouseMoveMap.startPos=k(a.mouseMoveMap.startPos)),(p=a.mouseMoveMap)!=null&&p.smallEyes&&(a.mouseMoveMap.smallEyes.pos=k(a.mouseMoveMap.smallEyes.pos)),a.keyMapNodes=a.keyMapNodes.map(i=>{switch(i.type){case"KMT_CLICK":case"KMT_CLICK_TWICE":case"KMT_CLICK_MULTI":i=i,i.pos=k(i.pos);break;case"KMT_DRAG":i=i,i.startPos=k(i.startPos),i.endPos=k(i.endPos);break;case"KMT_STEER_WHEEL":i=i,i.centerPos=k(i.centerPos);break}return i});const n=new Blob([JSON.stringify(a,void 0,"  ")],{type:"application/json"}),t=document.createElement("a");t.href=window.URL.createObjectURL(n),t.download="keymap.json",t.style.display="none",document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(t.href),document.body.removeChild(t)}return vt(()=>{window.addEventListener("keydown",a=>{console.log(a.code),a.preventDefault()})}),(a,n)=>(m(),x("section",Ye,[s("div",Qe,[Ve,s("div",Xe,[s("div",{class:Kt(["name",`${I(M)?"":"draggable"}`]),draggable:!I(M),onDragstart:C}," \u9F20\u6807\u79FB\u52A8\u6620\u5C04 ",42,qe),s("div",Je,[I(M)?w("",!0):(m(),x(N,{key:0},[_(" \u62D6\u62FD\u6DFB\u52A0 "),Ze],64)),_(" \u9F20\u6807\u79FB\u52A8\u6620\u5C04 ")])]),s("div",ze,[s("div",{class:"name draggable",draggable:"true",onDragstart:n[0]||(n[0]=t=>E(t,"KMT_STEER_WHEEL"))}," \u65B9\u5411 ",32),s("div",{class:"name draggable",draggable:"true",onDragstart:n[1]||(n[1]=t=>E(t,"KMT_CLICK"))}," \u5355\u51FB ",32),s("div",{class:"name draggable",draggable:"true",onDragstart:n[2]||(n[2]=t=>E(t,"KMT_CLICK_TWICE"))}," \u53CC\u51FB ",32),s("div",{class:"name draggable",draggable:"true",onDragstart:n[3]||(n[3]=t=>E(t,"KMT_CLICK_MULTI"))}," \u8FDE\u51FB ",32),s("div",{class:"name draggable",draggable:"true",onDragstart:n[4]||(n[4]=t=>E(t,"KMT_DRAG"))}," \u62D6\u62FD ",32),ta]),s("div",ea,[s("div",aa,[_(" \u9009\u62E9\u622A\u56FE "),s("input",{type:"file",class:"choose-screenshot",accept:"image/*",onChange:y},null,32)]),sa]),s("div",{class:"key-type-item"},[s("div",{class:"name save",onClick:ct}," \u4FDD\u5B58 "),ra])]),s("div",{class:"screenshot-container",ref_key:"screenshotContainerRef",ref:f},[s("img",{src:r.value,ref_key:"screenshotRef",ref:h,onLoad:L},null,40,ca),(m(),x("svg",{class:"screenshot-map-keys",version:"1.1",baseProfile:"full",onMousedown:T,ondragover:"return false",onDrop:P,width:c.width,height:c.height,viewBox:I(b),xmlns:"https://www.w3.org/2000/svg","xmlns:xlink":"https://www.w3.org/1999/xlink","xml:space":"preserve"},[(m(!0),x(N,null,Lt(I(D),(t,o)=>(m(),x(N,null,[(t==null?void 0:t.data.type)==="KMT_CLICK"?(m(),x("circle",{key:0,"data-keyNode":"keyNode","data-index":o,"data-type":t.data.type,r:"20",cx:t==null?void 0:t.x,cy:t==null?void 0:t.y,fill:"rgba(0,0,0,0.9)"},[s("text",null,F(t.text),1)],8,oa)):w("",!0),(t==null?void 0:t.data.type)==="KMT_CLICK_TWICE"?(m(),x("g",ia,[s("circle",{r:"10",cx:t==null?void 0:t.x,cy:t==null?void 0:t.y,fill:"rgba(0,0,0,0.45)"},null,8,ua),s("circle",{"data-keyNode":"keyNode","data-index":o,"data-type":t.data.type,r:"20",cx:t==null?void 0:t.x,cy:t==null?void 0:t.y,fill:"rgba(0,0,0,0.45)"},[s("text",null,F(t.text),1)],8,la)])):w("",!0),(t==null?void 0:t.data.type)==="KMT_CLICK_MULTI"?(m(),x("g",ya,[s("circle",{r:"6",cx:t==null?void 0:t.x,cy:t==null?void 0:t.y,fill:"rgba(0,0,0,0.3)"},null,8,pa),s("circle",{r:"12",cx:t==null?void 0:t.x,cy:t==null?void 0:t.y,fill:"rgba(0,0,0,0.3)"},null,8,ga),s("circle",{"data-keyNode":"keyNode","data-index":o,"data-type":t.data.type,r:"20",cx:t==null?void 0:t.x,cy:t==null?void 0:t.y,fill:"rgba(0,0,0,0.3)"},[s("text",null,F(t.text),1)],8,fa)])):w("",!0),(t==null?void 0:t.data.type)==="KMT_DRAG"?(m(),x("g",_a,[s("line",{x1:t==null?void 0:t.x1,y1:t==null?void 0:t.y1,x2:t==null?void 0:t.x2,y2:t==null?void 0:t.y2,stroke:"rgba(0,0,0,0.6)","stroke-width":"4","stroke-linecap":"round"},[s("text",null,F(t.text),1)],8,ba),s("circle",{"data-keyNode":"keyNode","data-index":o,"data-type":`${t.data.type}_start`,r:"6",cx:t==null?void 0:t.x1,cy:t==null?void 0:t.y1,fill:"rgba(0,0,0,0.9)","stroke-width":"2"},null,8,Ta),s("circle",{"data-keyNode":"keyNode","data-index":o,"data-type":`${t.data.type}_end`,r:"6",cx:t==null?void 0:t.x2,cy:t==null?void 0:t.y2,fill:"rgba(0,0,0,0.9)"},null,8,da)])):w("",!0),(t==null?void 0:t.data.type)==="KMT_STEER_WHEEL"?(m(),x("g",ma,[s("circle",{"data-keyNode":"keyNode","data-index":o,"data-type":t.data.type,r:"20",cx:t==null?void 0:t.x,cy:t==null?void 0:t.y,fill:"rgba(0,0,0,0.3)",stroke:"rgba(0,0,0)","stroke-width":"2"},null,8,xa)])):w("",!0)],64))),256))],40,na))],512)]))}});export{Ca as default};
